@using INTRANET.Models
@model  HrCvListVM

@{
    ViewBag.Title = "HR CV";
}

<h2>@ViewBag.Title</h2>
<div class="container">
    <h3>Departments</h3>
    @foreach (var item in Model.Departments)
    {
        <div class="col col-md-2">
            <label>
                <input type="checkbox"
                       name="selectedDepartments"
                       value="@item.Value" /> @item.Text
                </label>
            </div>
    }
</div>
<div class="container">
    <h3>Positions</h3>
    @foreach (var item in Model.Positions)
    {
        <div class="col col-md-2">
            <label>
                <input type="checkbox"
                       name="selectedPositions"
                       value="@item.Value" /> @item.Text
                </label>
            </div>
    }
</div>

<div class="container">
    <br />
    <div>
        <table id="hrEmployeGrid" class="table table-striped table-bordered dt-responsive nowrap" width="100%" cellspacing="0">
            <thead>
                <tr>
                    <th><input name="select_all" value="1" id="example-select-all" type="checkbox" /></th>
                    <th>Full name</th>
                    <th>Department </th>
                    <th>Position</th>
                    <th>CV Uz</th>
                    <th>CV Ru</th>
                    <th>Docs</th>
                </tr>
            </thead>
        </table>
    </div>
</div>


<button type="button" id="CVStatus" class="btn btn-info" data-toggle="modal" data-target="#status">CV completion status</button>
<div class="modal" role="dialog" id="status">
    <div class="modal-dialog modal-sm" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">CV status change options</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form>

                    @Html.DropDownList("CVStatusChangeOption",
                    new List<SelectListItem>() {
                      new SelectListItem { Text="Selected employees", Value="1", Selected=true},
                         new SelectListItem { Text="All employees ", Value="2"},
                    },
                    //"Select",
                    new { @class = "form-control" })

                    <div class="modal-footer">
                        <button type="button" class="btn btn-success">Submit</button>
                        <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section Styles {
    <link href="~/Scripts/DataTables/datatables.min.css" rel="stylesheet" />
    <link href="~/Scripts/DataTables/DataTables-1.10.13/css/dataTables.checkboxes.css" rel="stylesheet" />
    <link href="~/Content/hrCvEmployeeList.css" rel="stylesheet" runat="server" />
    <link href="~/Content/bootstrap.min.css" rel="stylesheet" type="text/css" />

}


@section Scripts {

    <script src="~/Scripts/DataTables/datatables.min.js"></script>
    <script src="~/Scripts/DataTables/DataTables-1.10.13/js/dataTables.checkboxes.min.js"></script>
    <script src="~/Scripts/bootstrap.min.js" type="text/javascript"></script>


    <script>
        $('#CVStatus').click(function () {
            $("#status").modal();
        });
    </script>


    <script>
        $(document).ready(function () {
            $("#hrEmployeGrid").DataTable({
                "processing": true, // for show progress bar
                "serverSide": true, // for process server side
                "filter": true, // this is for disable filter (search box)
                "orderMulti": false, // for disable multiple column at once
                //"pageLength": 5,

                "ajax": {
                    "url": "/HrCv/LoadData",
                    "type": "POST",
                    "datatype": "json",
                    "data": {
                        "selectedDepartments": function GetSelectedDepartments() {
                            var departments = [];
                            $.each($("input[name='selectedDepartments']:checked"), function () {
                                departments.push($(this).val());
                            });

                            return departments;
                        },
                        "selectedPositions": function GetSelectedPositions() {
                            var positions = [];
                            $.each($("input[name='selectedPositions']:checked"), function () {
                                positions.push($(this).val());
                            });

                            return positions;
                        }
                    }
                },

                "columnDefs":
                    [
                        {
                            "targets": [0],
                            "searchable": false,
                            "orderable": false,
                            "render": function (data, type, full, meta) {
                                return '<input type="checkbox" name="selectedEmployees" value="'
                                    + data.Id + '">';
                            }

                        },
                        {
                            "targets": [4],
                            "searchable": false,
                            "orderable": false,
                            "render": function (data, type, full, meta) {
                                var checked = '';
                                if (data)
                                    checked = 'checked="checked"';

                                return '<input type="checkbox" disabled="disabled" '
                                    + checked + '>' +
                                    '<span class="glyphicon glyphicon-edit"></span>' +
                                    '<span class="glyphicon glyphicon-download-alt"></span>';
                            }
                        },
                        {
                            "targets": [5],
                            "searchable": false,
                            "orderable": false,
                            "render": function (data, type, full, meta) {
                                var checked = '';
                                if (data)
                                    checked = 'checked="checked"';

                                return '<input type="checkbox" disabled="disabled" '
                                    + checked + '>' +
                                    '<span class="glyphicon glyphicon-edit"></span>' +
                                    '<span class="glyphicon glyphicon-download-alt"></span>';
                            }
                        },
                        {
                            "targets": [6],
                            "searchable": false,
                            "orderable": false,
                            "render": function (data, type, full, meta) {
                                return '<a href="/HrEmployeeDocument/Index/' + data.Id + '" ><span class="glyphicon glyphicon-file"></span></a>';
                            }
                        },


                    ],
                "select": {
                    'style': 'multi'
                },
                "order": [[1, 'asc']],
                "columns": [
                    { "data": {} },
                    { "data": "FullName", "name": "FullName", "autoWidth": true },
                    { "data": "DepartmentName", "name": "DepartmentName", "autoWidth": true },
                    { "data": "PositionName", "name": "PositionName", "autoWidth": true },
                    { "data": "HasFilledRuCV", "name": "HasFilledRuCV", "autoWidth": true },
                    { "data": "HasFilledUzCV", "name": "HasFilledUzCV", "autoWidth": true },
                    { "data": {} },
                ]
            });
            //$("#hrEmployeGrid").DataTable().ajax.reload()
            //will reload the grid
        });


    </script>
}
